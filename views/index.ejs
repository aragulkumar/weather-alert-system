<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Alert</title>
  <link rel="stylesheet" href="/main.css">
</head>

<body>

    <div class="container">
    <h1>ðŸŒ¦ Weather Alert System</h1>

    <form action="/" method="POST" class="weather-form">
      <input type="text" name="city" placeholder="Enter city" required>

      <select name="day">
        <option value="today">Today</option>
        <option value="tomorrow">Tomorrow</option>
      </select>

      <button type="submit">Check Alerts</button>
    </form>
    <% if (history && history.length > 0) { %>
        <div style="margin-top: 15px;">
            <label style="color:white;">Recent searches:</label>

            <select id="historySelect" onchange="handleHistorySelect(this.value)">
                <option value="">Select</option>
                <% history.forEach(h => { %>
                    <option value="<%= h.city %>|<%= h.day %>">
                    <%= h.city %> (<%= h.day %>)
                    </option>
                <% }) %>
                </select>


        </div>
    <% } %>

    <% if (error) { %>
        <p style="color: yellow; margin-top: 20px;">
            âš  <%= error %>
        </p>
    <% } %>

    <% if (weather) { %>
      <div class="weather-card">
        <h2><%= weather.city %> â€” <%= weather.dayLabel %></h2>
        <p>ðŸŒ¡ Avg Temp: <%= weather.temp %> Â°C</p>

        <% if (weather.alerts.length > 0) { %>
          <div class="alerts">
            <h3>âš  Alerts</h3>
            <ul>
                <% weather.alerts.forEach(a => { %>
                    <li class="alert <%= a.type %>"><%= a.message %></li>
                <% }) %>
            </ul>

          </div>
        <% } else { %>
          <p class="safe">âœ… No alerts expected</p>
        <% } %>
      </div>

    <% } %>

    </div>

    <script>
    function handleHistorySelect(value) {
    console.log("History clicked:", value); // DEBUG

    if (!value) return;

    const [city, day] = value.split("|");

    document.querySelector('input[name="city"]').value = city;
    document.querySelector('select[name="day"]').value = day;

    // Reset dropdown so it can be used again
    document.getElementById("historySelect").value = "";

    // Submit the SAME form
    document.querySelector(".weather-form").submit();
  }
</script>

</body>
</html>
